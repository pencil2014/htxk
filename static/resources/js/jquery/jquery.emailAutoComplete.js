function EmailAutoComplete(a){this.config={targetCls:".inputElem",parentCls:".parentCls",hiddenCls:".hiddenCls",searchForm:".jqtransformdone",hoverBg:"hoverBg",inputValColor:"black",mailArr:["@qq.com","@gmail.com","@126.com","@163.com","@hotmail.com","@yahoo.com","@yahoo.com.cn","@live.com","@sohu.com","@sina.com"],isSelectHide:true,callback:null};this.cache={onlyFlag:true,currentIndex:-1,oldIndex:-1};this.init(a)}EmailAutoComplete.prototype={constructor:EmailAutoComplete,init:function(b){this.config=$.extend(this.config,b||{});var a=this,c=a.config,d=a.cache;$(c.targetCls).each(function(e,f){$(f).keyup(function(m){var l=m.target,k=$.trim($(this).val()),h=m.keyCode,i=$(this).outerHeight(),j=$(this).outerWidth(),g=$(this).closest(c.parentCls);$(g).css({"position":"relative"});if(k==""){$(f).attr({"data-html":""});$(c.hiddenCls,g).val("");d.currentIndex=-1;d.oldIndex=-1;$(".auto-tip",g)&&!$(".auto-tip",g).hasClass("hidden")&&$(".auto-tip",g).addClass("hidden");a._removeBg(g)}else{$(f).attr({"data-html":k});$(c.hiddenCls,g).val(k);$(".auto-tip",g)&&$(".auto-tip",g).hasClass("hidden")&&$(".auto-tip",g).removeClass("hidden");a._renderHTML({keycode:h,e:m,target:l,targetVal:k,height:i,width:j,parentNode:g})}})});$(c.searchForm).each(function(e,f){$(f).keydown(function(h){var g=h.keyCode;if(g==13){return false}})});$(document).click(function(h){h.stopPropagation();var g=h.target,f=c.targetCls.replace(/^\./,"");if(!$(g).hasClass(f)){$(".auto-tip")&&$(".auto-tip").each(function(e,i){!$(i).hasClass("hidden")&&$(i).addClass("hidden")})}})},_renderHTML:function(a){var b=this,g=b.config,h=b.cache,e;var d=b._keyCode(a.keycode);$(".auto-tip",a.parentNode).hasClass("hidden")&&$(".auto-tip",a.parentNode).removeClass("hidden");if(d>-1){b._keyUpAndDown(a.targetVal,a.e,a.parentNode)}else{if(/@/.test(a.targetVal)){e=a.targetVal.replace(/@.*/,"")}else{e=a.targetVal}if(h.onlyFlag){$(a.parentNode).append('<input type="hidden" class="hiddenCls"/>');var f='<ul class="auto-tip">';for(var c=0;c<g.mailArr.length;c++){f+='<li class="p-index'+c+'">'+'<span class="output-num"></span><em class="em" data-html="'+g.mailArr[c]+'">'+g.mailArr[c]+"</em></li>"}f+="</ul>";h.onlyFlag=false;$(a.parentNode).append(f);$(".auto-tip",a.parentNode).css({"position":"absolute","top":a.height,"width":a.width-2+"px","left":165,"border":"1px solid #eee","z-index":10000,"background":"#ffffff","borderTop":"none"})}$(".auto-tip li",a.parentNode).each(function(i,j){$(".output-num",j).html(e);!$(".output-num",j).hasClass(g.inputValColor)&&$(".output-num",j).addClass(g.inputValColor);var k=$.trim($(".em",j).attr("data-html"));$(j).attr({"data-html":e+""+k})});b._accurateMate({target:a.target,parentNode:a.parentNode});b._itemHover(a.parentNode);b._executeClick(a.parentNode)}},_accurateMate:function(f){var l=this,g=l.config,a=l.cache;var h=$.trim($(f.target,f.parentNode).attr("data-html")),c=[];if(/@/.test(h)){var e=h.replace(/@.*/,""),k=h.replace(/.*@/,"");$.map(g.mailArr,function(m){var j=new RegExp(k);if(j.test(m)){c.push(m)}});if(c.length>0){$(".auto-tip",f.parentNode).html("");$(".auto-tip",f.parentNode)&&$(".auto-tip",f.parentNode).hasClass("hidden")&&$(".auto-tip",f.parentNode).removeClass("hidden");var d="";for(var b=0,i=c.length;b<i;b++){d+='<li class="p-index'+b+'">'+'<span class="output-num"></span><em class="em" data-html="'+c[b]+'">'+c[b]+"</em></li>"}$(".auto-tip",f.parentNode).html(d);$(".auto-tip li",f.parentNode).each(function(j,m){$(".output-num",m).html(e);!$(".output-num",m).hasClass(g.inputValColor)&&$(".output-num",m).addClass(g.inputValColor);var n=$.trim($(".em",m).attr("data-html"));$(m).attr("data-html","");$(m).attr({"data-html":e+""+n})});a.currentIndex=-1;a.oldIndex=-1;$(".auto-tip .output-num",f.parentNode).html(e);l._itemHover(f.parentNode);l._executeClick(f.parentNode)}else{$(".auto-tip",f.parentNode)&&!$(".auto-tip",f.parentNode).hasClass("hidden")&&$(".auto-tip",f.parentNode).addClass("hidden");$(".auto-tip",f.parentNode).html("")}}},_itemHover:function(a){var b=this,c=b.config,d=b.cache;$(".auto-tip li",a).hover(function(e,f){!$(this).hasClass(c.hoverBg)&&$(this).addClass(c.hoverBg)},function(){$(this).hasClass(c.hoverBg)&&$(this).removeClass(c.hoverBg)})},_removeBg:function(a){var b=this,c=b.config;$(".auto-tip li",a).each(function(d,e){$(e).hasClass(c.hoverBg)&&$(e).removeClass(c.hoverBg)})},_keyUpAndDown:function(c,f,d){var k=this,a=k.cache,h=k.config;if($(".auto-tip"+" li",d)&&$(".auto-tip"+" li").length>0){var b=$(".auto-tip"+" li",d).length,j=f.keyCode;a.oldIndex=a.currentIndex;if(j==38){if(a.currentIndex==-1){a.currentIndex=b-1}else{a.currentIndex=a.currentIndex-1;if(a.currentIndex<0){a.currentIndex=b-1}}if(a.currentIndex!==-1){!$(".auto-tip .p-index"+a.currentIndex,d).hasClass(h.hoverBg)&&$(".auto-tip .p-index"+a.currentIndex,d).addClass(h.hoverBg).siblings().removeClass(h.hoverBg);var g=$(".auto-tip"+" .p-index"+a.currentIndex,d).attr("data-html");$(h.targetCls,d).val(g);$(h.hiddenCls,d).val(g)}}else{if(j==40){if(a.currentIndex==b-1){a.currentIndex=0}else{a.currentIndex++;if(a.currentIndex>b-1){a.currentIndex=0}}if(a.currentIndex!==-1){!$(".auto-tip .p-index"+a.currentIndex,d).hasClass(h.hoverBg)&&$(".auto-tip .p-index"+a.currentIndex,d).addClass(h.hoverBg).siblings().removeClass(h.hoverBg);var g=$(".auto-tip"+" .p-index"+a.currentIndex,d).attr("data-html");$(h.targetCls,d).val(g);$(h.hiddenCls,d).val(g)}}else{if(j==13){var i=$(".auto-tip"+" .p-index"+a.oldIndex,d).attr("data-html");$(h.targetCls,d).val(i);$(h.hiddenCls,d).val(i);if(h.isSelectHide){!$(".auto-tip",d).hasClass("hidden")&&$(".auto-tip",d).addClass("hidden")}h.callback&&$.isFunction(h.callback)&&h.callback();a.currentIndex=-1;a.oldIndex=-1}}}}},_keyCode:function(d){var a=["17","18","38","40","37","39","33","34","35","46","36","13","45","44","145","19","20","9"];for(var c=0,b=a.length;c<b;c++){if(d==a[c]){return c}}return -1},_executeClick:function(b){var a=this,c=a.config;$(".auto-tip"+" li",b).unbind("click");$(".auto-tip"+" li",b).bind("click",function(f){var d=$(this).attr("data-html");$(c.targetCls,b).val(d);if(c.isSelectHide){!$(".auto-tip",b).hasClass("hidden")&&$(".auto-tip",b).addClass("hidden")}$(c.hiddenCls,b).val(d);b.find("input").focus().blur();c.callback&&$.isFunction(c.callback)&&c.callback()})}};$(function(){new EmailAutoComplete({})});